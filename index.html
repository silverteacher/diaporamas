<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>G√©n√©rateur PowerPoint Moderne</title>
<script src="https://cdn.jsdelivr.net/gh/gitbrent/pptxgenjs/dist/pptxgen.bundle.js"></script>
<style>
  /* Reset & base */
  *, *::before, *::after {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f5f7fa;
    color: #222;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 30px 15px;
  }
  .container {
    background: white;
    max-width: 900px;
    width: 100%;
    border-radius: 12px;
    box-shadow: 0 12px 24px rgba(0,0,0,0.12);
    padding: 30px 40px;
  }
  h1 {
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 5px;
  }
  p.subtitle {
    color: #7f8c8d;
    margin-bottom: 30px;
    font-size: 1.1rem;
  }
  label {
    display: block;
    font-weight: 600;
    margin-bottom: 8px;
    color: #34495e;
  }
  input[type="text"], select, textarea {
    width: 100%;
    padding: 12px 15px;
    border: 1.8px solid #bdc3c7;
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s ease;
    font-family: inherit;
    resize: vertical;
  }
  input[type="text"]:focus, select:focus, textarea:focus {
    border-color: #2980b9;
    outline: none;
    box-shadow: 0 0 8px rgba(41, 128, 185, 0.3);
  }
  textarea {
    min-height: 100px;
  }
  .slides-container {
    margin-top: 25px;
    border: 1px solid #dfe6e9;
    border-radius: 10px;
    padding: 20px;
    background: #fafafa;
    max-height: 450px;
    overflow-y: auto;
  }
  .slide-item {
    background: white;
    border: 1px solid #dcdde1;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    position: relative;
    box-shadow: 0 1px 4px rgba(0,0,0,0.05);
  }
  .slide-item h4 {
    margin-bottom: 15px;
    color: #2980b9;
    font-weight: 600;
  }
  .remove-slide {
    position: absolute;
    top: 12px;
    right: 12px;
    background: #e74c3c;
    border: none;
    color: white;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    font-size: 18px;
    cursor: pointer;
    line-height: 28px;
    text-align: center;
    transition: background-color 0.3s ease;
  }
  .remove-slide:hover {
    background: #c0392b;
  }
  select {
    margin-top: 10px;
  }
  .image-upload {
    margin-top: 12px;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .image-upload label {
    background: #2980b9;
    color: white;
    padding: 8px 18px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    font-size: 0.9rem;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  .image-upload label:hover {
    background: #1c5980;
  }
  .image-upload input[type="file"] {
    display: none;
  }
  .image-preview {
    max-width: 120px;
    max-height: 80px;
    border-radius: 6px;
    border: 1px solid #ccc;
    object-fit: contain;
    display: none;
  }
  .image-info {
    font-size: 0.85rem;
    color: #7f8c8d;
  }
  .controls {
    margin-top: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  button.btn {
    cursor: pointer;
    border: none;
    border-radius: 10px;
    font-weight: 700;
    font-size: 1.1rem;
    padding: 14px 36px;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }
  button.btn-primary {
    background-color: #2980b9;
    color: white;
    box-shadow: 0 6px 12px rgba(41, 128, 185, 0.4);
  }
  button.btn-primary:hover {
    background-color: #1c5980;
    box-shadow: 0 8px 16px rgba(28, 89, 128, 0.6);
  }
  button.btn-secondary {
    background-color: #7f8c8d;
    color: white;
  }
  button.btn-secondary:hover {
    background-color: #636e72;
  }
  .loading {
    margin-top: 20px;
    display: none;
    align-items: center;
    gap: 10px;
    color: #2980b9;
    font-weight: 600;
  }
  .loading.active {
    display: flex;
  }
  .spinner {
    width: 22px;
    height: 22px;
    border: 3px solid #dfe6e9;
    border-top-color: #2980b9;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  .success-message {
    margin-top: 20px;
    background-color: #dff9d6;
    border: 1.5px solid #27ae60;
    color: #27ae60;
    font-weight: 700;
    padding: 15px 20px;
    border-radius: 10px;
    display: none;
    text-align: center;
  }
  .success-message.active {
    display: block;
  }
</style>
</head>
<body>
  <div class="container" role="main" aria-label="G√©n√©rateur de pr√©sentation PowerPoint">
    <h1>G√©n√©rateur PowerPoint</h1>
    <p class="subtitle">Cr√©ez vos pr√©sentations personnalis√©es simplement, avec images et contenus.</p>

    <form id="presentationForm" aria-describedby="formInstructions" style="opacity: 0.5;">
      <div class="form-group">
        <label for="title">Titre de la pr√©sentation <sup aria-label="obligatoire">*</sup></label>
        <input type="text" id="title" name="title" placeholder="Ex: Ma pr√©sentation incroyable" required autocomplete="off" />
      </div>

      <div class="form-group">
        <label for="author">Auteur</label>
        <input type="text" id="author" name="author" placeholder="Votre nom" autocomplete="off" />
      </div>

      <div class="form-group">
        <label for="theme">Th√®me de couleur</label>
        <select id="theme" name="theme" aria-label="Choisir un th√®me de couleur">
          <option value="blue">Bleu professionnel</option>
          <option value="green">Vert nature</option>
          <option value="purple">Violet cr√©atif</option>
          <option value="orange">Orange √©nergique</option>
          <option value="red">Rouge dynamique</option>
        </select>
      </div>

      <div class="form-group">
        <label>Diapositives</label>
        <div class="slides-container" id="slidesContainer" aria-live="polite" aria-relevant="additions removals"></div>
        <div class="controls">
          <button type="button" class="btn btn-secondary" aria-label="Ajouter une nouvelle diapositive" onclick="addSlide()">+ Ajouter une diapositive</button>
          <span id="slideCount" aria-live="polite">0 diapositive(s)</span>
        </div>
      </div>

      <div style="text-align:center; margin-top: 35px;">
        <button type="submit" class="btn btn-primary" aria-label="G√©n√©rer et t√©l√©charger la pr√©sentation PowerPoint">üì• G√©n√©rer et T√©l√©charger PowerPoint</button>
      </div>

      <div class="loading" id="loading" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="spinner" aria-hidden="true"></div>
        <span>G√©n√©ration en cours...</span>
      </div>

      <div class="success-message" id="successMessage" role="alert" aria-live="polite" aria-atomic="true">
        ‚úÖ Pr√©sentation g√©n√©r√©e avec succ√®s ! Le t√©l√©chargement va commencer automatiquement.
      </div>
    </form>
  </div>

<script>
  let slideCounter = 0;
  const themes = {
    blue: { primary: '4472C4', secondary: '70AD47', background: 'FFFFFF' },
    green: { primary: '70AD47', secondary: '4472C4', background: 'FFFFFF' },
    purple: { primary: '7030A0', secondary: 'C55A11', background: 'FFFFFF' },
    orange: { primary: 'C55A11', secondary: '7030A0', background: 'FFFFFF' },
    red: { primary: 'C5504B', secondary: '4472C4', background: 'FFFFFF' }
  };

  const defaultSlides = [
    "Diapo avec le titre et l'illustration",
    "Diapo avec le temps de la visio",
    "Diapo avec la pr√©sentation des animateurs",
    "Diapo avec le sommaire",
    "Diapo brise glace"
  ];
  const endSlides = [
    "Diapo Pause",
    "Diapo des questions",
    "Diapo contact"
  ];

  // Ajoute une diapositive, optionnellement avec titre par d√©faut
  function addSlide(defaultTitle = "") {
    slideCounter++;
    const container = document.getElementById('slidesContainer');
    const slideDiv = document.createElement('div');
    slideDiv.className = 'slide-item';
    slideDiv.innerHTML = `
      <button type="button" class="remove-slide" aria-label="Supprimer cette diapositive" onclick="removeSlide(this)">√ó</button>
      <h4>${defaultTitle ? defaultTitle : `Diapositive ${slideCounter}`}</h4>
      <input type="text" placeholder="Titre de la diapositive" name="slideTitle${slideCounter}" value="${defaultTitle}" required autocomplete="off" />
      <textarea placeholder="Contenu de la diapositive (puces possibles avec - ou ‚Ä¢)" name="slideContent${slideCounter}" required></textarea>
      <select name="slideLayout${slideCounter}" onchange="toggleImageUpload(this, ${slideCounter})" aria-label="Choisir le type de contenu">
        <option value="title">Titre et contenu</option>
        <option value="bullets">Liste √† puces</option>
        <option value="image">Titre et image</option>
      </select>
      <div class="image-upload" id="imageUpload${slideCounter}" style="display:none;">
        <label for="imageFile${slideCounter}">üìÅ Choisir une image</label>
        <input type="file" id="imageFile${slideCounter}" accept="image/*" onchange="previewImage(this, ${slideCounter})" />
        <img class="image-preview" id="imagePreview${slideCounter}" alt="Aper√ßu de l'image" />
        <span class="image-info" id="imageInfo${slideCounter}"></span>
      </div>
    `;
    container.appendChild(slideDiv);
    updateSlideCount();
  }

  function toggleImageUpload(selectElem, slideNum) {
    const uploadDiv = document.getElementById(`imageUpload${slideNum}`);
    uploadDiv.style.display = selectElem.value === 'image' ? 'flex' : 'none';
  }

  function previewImage(input, slideNum) {
    const preview = document.getElementById(`imagePreview${slideNum}`);
    const info = document.getElementById(`imageInfo${slideNum}`);
    if (input.files && input.files[0]) {
      const file = input.files[0];
      const reader = new FileReader();
      reader.onload = e => {
        preview.src = e.target.result;
        preview.style.display = 'block';
        info.textContent = `${file.name} (${(file.size/1024).toFixed(1)} KB)`;
      };
      reader.readAsDataURL(file);
    } else {
      preview.style.display = 'none';
      info.textContent = '';
    }
  }

  function removeSlide(btn) {
    btn.parentElement.remove();
    updateSlideCount();
  }

  function updateSlideCount() {
    const count = document.querySelectorAll('.slide-item').length;
    document.getElementById('slideCount').textContent = `${count} diapositive(s)`;
  }

  // Initialise le formulaire avec les diapositives par d√©faut
  document.addEventListener('DOMContentLoaded', () => {
    checkLibraryLoaded();
    defaultSlides.forEach(title => addSlide(title));
  });

  function checkLibraryLoaded() {
    const maxAttempts = 50;
    let attempts = 0;
    const interval = setInterval(() => {
      attempts++;
      if (typeof PptxGenJS !== 'undefined') {
        clearInterval(interval);
        document.getElementById('presentationForm').style.opacity = '1';
      } else if (attempts >= maxAttempts) {
        clearInterval(interval);
        alert('Erreur : Impossible de charger la biblioth√®que PowerPoint. Actualisez la page.');
      }
    }, 100);
  }

  document.getElementById('presentationForm').addEventListener('submit', async e => {
    e.preventDefault();
    await generatePowerPoint();
  });

  async function generatePowerPoint() {
    const loading = document.getElementById('loading');
    const successMsg = document.getElementById('successMessage');
    loading.classList.add('active');
    successMsg.classList.remove('active');
    try {
      if (typeof PptxGenJS === 'undefined') throw new Error('Biblioth√®que non charg√©e.');

      const pptx = new PptxGenJS();
      const formData = new FormData(document.getElementById('presentationForm'));
      const title = formData.get('title');
      const author = formData.get('author');
      const themeName = formData.get('theme');
      const theme = themes[themeName];
      pptx.author = author || 'G√©n√©rateur PowerPoint';
      pptx.title = title;
      pptx.subject = 'Pr√©sentation g√©n√©r√©e automatiquement';

      // G√©n√®re toutes les diapositives saisies (fixes + ajout√©es)
      const slides = document.querySelectorAll('.slide-item');
      const slidePromises = Array.from(slides).map(async (slideElem, idx) => {
        const inputs = slideElem.querySelectorAll('input[type="text"], textarea, select');
        const slideTitle = inputs[0].value.trim();
        const slideContent = inputs[1].value.trim();
        const slideLayout = inputs[2].value;
        const slide = pptx.addSlide();
        slide.background = { color: theme.background };
        slide.addText(slideTitle, {
          x: 0.5, y: 0.5, w: 9, h: 1,
          fontSize: 28, color: theme.primary, bold: true
        });

        if (slideLayout === 'bullets') {
          const bullets = slideContent.split('\n').filter(line => line.trim()).map(line => line.replace(/^[-‚Ä¢]\s*/, ''));
          slide.addText(bullets, {
            x: 0.5, y: 1.8, w: 9, h: 5,
            fontSize: 18, color: '333333', bullet: true
          });
        } else if (slideLayout === 'image') {
          slide.addText(slideContent, {
            x: 0.5, y: 1.8, w: 4.5, h: 3,
            fontSize: 16, color: '333333', valign: 'top'
          });
          const fileInput = slideElem.querySelector('input[type="file"]');
          if (fileInput && fileInput.files && fileInput.files[0]) {
            const file = fileInput.files[0];
            return new Promise(resolve => {
              const reader = new FileReader();
              reader.onload = e => {
                slide.addImage({
                  data: e.target.result,
                  x: 5.5, y: 2, w: 4, h: 3,
                  sizing: { type: "contain" }
                });
                resolve();
              };
              reader.readAsDataURL(file);
            });
          } else {
            slide.addText('üì∑\n[Aucune image s√©lectionn√©e]', {
              x: 5.5, y: 2, w: 4, h: 3,
              fontSize: 14, color: '#999999',
              align: 'center', valign: 'middle',
              fill: { color: 'F5F5F5' },
              line: { color: 'CCCCCC', width: 1 }
            });
          }
        } else {
          slide.addText(slideContent, {
            x: 0.5, y: 1.8, w: 9, h: 5,
            fontSize: 18, color: '333333', valign: 'top'
          });
        }
      });

      // Ajoute les diapositives fixes de fin automatiquement
      endSlides.forEach(title => {
        const slide = pptx.addSlide();
        slide.background = { color: theme.background };
        slide.addText(title, {
          x: 0.5, y: 0.5, w: 9, h: 1,
          fontSize: 28, color: theme.primary, bold: true
        });
      });

      await Promise.all(slidePromises);

      const fileName = title ? `${title.replace(/[^\w\s]/gi, '')}.pptx` : 'presentation.pptx';
      await pptx.writeFile({ fileName });
      loading.classList.remove('active');
      successMsg.classList.add('active');
      setTimeout(() => successMsg.classList.remove('active'), 5000);
    } catch (err) {
      loading.classList.remove('active');
      alert('Erreur lors de la g√©n√©ration : ' + err.message);
      console.error(err);
    }
  }
</script>
</body>
</html>
