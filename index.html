<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>G√©n√©rateur PowerPoint Color√© & Moderne</title>
<script src="https://cdn.jsdelivr.net/gh/gitbrent/pptxgenjs/dist/pptxgen.bundle.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

  body {
    margin: 0; padding: 0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
    color: #fff;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    padding: 40px 20px;
  }
  .container {
    background: #fff;
    color: #222;
    max-width: 900px;
    width: 100%;
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.25);
    padding: 40px 50px;
    position: relative;
    overflow: hidden;
  }
  /* Arri√®re-plan g√©om√©trique color√© */
  .container::before {
    content: "";
    position: absolute;
    top: -120px; left: -120px;
    width: 300px; height: 300px;
    background: #6a11cb;
    clip-path: polygon(0 0, 100% 0, 0 100%);
    opacity: 0.3;
    z-index: 0;
  }
  .container::after {
    content: "";
    position: absolute;
    bottom: -140px; right: -140px;
    width: 320px; height: 320px;
    background: #2575fc;
    clip-path: polygon(100% 0, 100% 100%, 0 100%);
    opacity: 0.3;
    z-index: 0;
  }
  h1 {
    font-weight: 700;
    font-size: 2.8rem;
    color: #1e1e2f;
    margin-bottom: 10px;
    position: relative;
    z-index: 1;
  }
  p.subtitle {
    color: #555770;
    font-size: 1.15rem;
    margin-bottom: 36px;
    position: relative;
    z-index: 1;
  }
  label {
    display: block;
    font-weight: 600;
    margin-bottom: 8px;
    color: #44475a;
    font-size: 1rem;
  }
  input[type="text"], select, textarea {
    width: 100%;
    padding: 14px 18px;
    border: 2px solid #6a11cb;
    border-radius: 15px;
    font-size: 1rem;
    font-family: inherit;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
    background: #f8f9ff;
    color: #222;
  }
  input[type="text"]:focus, select:focus, textarea:focus {
    border-color: #2575fc;
    outline: none;
    box-shadow: 0 0 12px rgba(37, 117, 252, 0.6);
    background: #fff;
  }
  textarea {
    min-height: 110px;
    resize: vertical;
  }
  .slides-container {
    margin-top: 28px;
    border: 3px solid #6a11cb;
    border-radius: 20px;
    padding: 30px 36px;
    background: #eef2ff;
    max-height: 480px;
    overflow-y: auto;
    position: relative;
    z-index: 1;
  }
  .slide-item {
    background: white;
    border-radius: 20px;
    padding: 24px 30px;
    margin-bottom: 28px;
    position: relative;
    box-shadow: 0 4px 16px rgba(106, 17, 203, 0.15);
    transition: box-shadow 0.3s ease;
  }
  .slide-item:hover {
    box-shadow: 0 8px 28px rgba(37, 117, 252, 0.3);
  }
  .slide-item h4 {
    margin-bottom: 18px;
    color: #6a11cb;
    font-weight: 700;
    font-size: 1.4rem;
  }
  .remove-slide {
    position: absolute;
    top: 16px;
    right: 16px;
    background: #ff3860;
    border: none;
    color: white;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    font-size: 20px;
    cursor: pointer;
    line-height: 32px;
    text-align: center;
    transition: background-color 0.3s ease;
  }
  .remove-slide:hover {
    background: #d32f4a;
  }
  select {
    margin-top: 14px;
    font-weight: 700;
    color: #6a11cb;
  }
  .image-upload {
    margin-top: 16px;
    display: flex;
    align-items: center;
    gap: 16px;
  }
  .image-upload label {
    background: #2575fc;
    color: white;
    padding: 10px 26px;
    border-radius: 20px;
    cursor: pointer;
    font-weight: 700;
    font-size: 1rem;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  .image-upload label:hover {
    background: #1b54b5;
  }
  .image-upload input[type="file"] {
    display: none;
  }
  .image-preview {
    max-width: 140px;
    max-height: 90px;
    border-radius: 12px;
    border: 2px solid #d1d8de;
    object-fit: contain;
    display: none;
    box-shadow: 0 4px 12px rgba(37, 117, 252, 0.15);
  }
  .image-info {
    font-size: 0.9rem;
    color: #6a11cb;
    font-style: italic;
  }
  .controls {
    margin-top: 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    z-index: 1;
  }
  button.btn {
    cursor: pointer;
    border: none;
    border-radius: 24px;
    font-weight: 700;
    font-size: 1.25rem;
    padding: 18px 52px;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }
  button.btn-primary {
    background-color: #6a11cb;
    color: white;
    box-shadow: 0 10px 24px rgba(106, 17, 203, 0.5);
  }
  button.btn-primary:hover {
    background-color: #4e0ea6;
    box-shadow: 0 14px 32px rgba(78, 14, 166, 0.7);
  }
  button.btn-secondary {
    background-color: #2575fc;
    color: white;
    box-shadow: 0 6px 18px rgba(37, 117, 252, 0.5);
  }
  button.btn-secondary:hover {
    background-color: #1b54b5;
    box-shadow: 0 8px 24px rgba(27, 84, 181, 0.7);
  }
  .loading {
    margin-top: 32px;
    display: none;
    align-items: center;
    gap: 14px;
    color: #6a11cb;
    font-weight: 700;
    font-size: 1.15rem;
  }
  .loading.active {
    display: flex;
  }
  .spinner {
    width: 26px;
    height: 26px;
    border: 4px solid #dcd6f7;
    border-top-color: #6a11cb;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  .success-message {
    margin-top: 32px;
    background-color: #d4f7dc;
    border: 2px solid #27ae60;
    color: #27ae60;
    font-weight: 700;
    padding: 18px 26px;
    border-radius: 24px;
    display: none;
    text-align: center;
    font-size: 1.2rem;
    position: relative;
    z-index: 1;
  }
  .success-message.active {
    display: block;
  }
</style>
</head>
<body>
  <main class="container" role="main" aria-label="G√©n√©rateur de pr√©sentation PowerPoint color√© et moderne">
    <h1>G√©n√©rateur PowerPoint</h1>
    <p class="subtitle">Cr√©ez des pr√©sentations dynamiques et color√©es avec vos contenus et images.</p>

    <form id="presentationForm" style="opacity: 0.5;">
      <div class="form-group">
        <label for="title">Titre de la pr√©sentation <sup aria-label="obligatoire">*</sup></label>
        <input type="text" id="title" name="title" placeholder="Ex: Ma pr√©sentation incroyable" required autocomplete="off" />
      </div>

      <div class="form-group">
        <label for="author">Auteur</label>
        <input type="text" id="author" name="author" placeholder="Votre nom" autocomplete="off" />
      </div>

      <div class="form-group">
        <label for="theme">Th√®me de couleur</label>
        <select id="theme" name="theme" aria-label="Choisir un th√®me de couleur">
          <option value="blue">Violet & Bleu</option>
          <option value="green">Vert nature</option>
          <option value="orange">Orange & Corail</option>
          <option value="red">Rouge & Rose</option>
          <option value="purple">Prune & Lavande</option>
        </select>
      </div>

      <div class="form-group">
        <label>Diapositives</label>
        <div class="slides-container" id="slidesContainer" aria-live="polite" aria-relevant="additions removals"></div>
        <div class="controls">
          <button type="button" class="btn btn-secondary" aria-label="Ajouter une nouvelle diapositive" onclick="addSlide()">+ Ajouter une diapositive</button>
          <span id="slideCount" aria-live="polite">0 diapositive(s)</span>
        </div>
      </div>

      <div style="text-align:center; margin-top: 40px;">
        <button type="submit" class="btn btn-primary" aria-label="G√©n√©rer et t√©l√©charger la pr√©sentation PowerPoint">üì• G√©n√©rer et T√©l√©charger PowerPoint</button>
      </div>

      <div class="loading" id="loading" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="spinner" aria-hidden="true"></div>
        <span>G√©n√©ration en cours...</span>
      </div>

      <div class="success-message" id="successMessage" role="alert" aria-live="polite" aria-atomic="true">
        ‚úÖ Pr√©sentation g√©n√©r√©e avec succ√®s ! Le t√©l√©chargement va commencer automatiquement.
      </div>
    </form>
  </main>

<script>
  let slideCounter = 0;
  const themes = {
    blue: { primary: '6a11cb', secondary: '2575fc', background: 'f0f4ff' },
    green: { primary: '27ae60', secondary: '2ecc71', background: 'e6f4ea' },
    orange: { primary: 'e67e22', secondary: 'f39c12', background: 'fff5e6' },
    red: { primary: 'e74c3c', secondary: 'ff6f61', background: 'ffe6e6' },
    purple: { primary: '8e44ad', secondary: '9b59b6', background: 'f3e6ff' }
  };

  const defaultSlides = [
    "Diapo avec le titre et l'illustration",
    "Diapo avec le temps de la visio",
    "Diapo avec la pr√©sentation des animateurs",
    "Diapo avec le sommaire",
    "Diapo brise glace"
  ];
  const endSlides = [
    "Diapo Pause",
    "Diapo des questions",
    "Diapo contact"
  ];

  function addSlide(defaultTitle = "") {
    slideCounter++;
    const container = document.getElementById('slidesContainer');
    const slideDiv = document.createElement('div');
    slideDiv.className = 'slide-item';
    slideDiv.innerHTML = `
      <button type="button" class="remove-slide" aria-label="Supprimer cette diapositive" onclick="removeSlide(this)">√ó</button>
      <h4>${defaultTitle ? defaultTitle : `Diapositive ${slideCounter}`}</h4>
      <input type="text" placeholder="Titre de la diapositive" name="slideTitle${slideCounter}" value="${defaultTitle}" required autocomplete="off" />
      <textarea placeholder="Contenu de la diapositive (puces possibles avec - ou ‚Ä¢)" name="slideContent${slideCounter}" required></textarea>
      <select name="slideLayout${slideCounter}" onchange="toggleImageUpload(this, ${slideCounter})" aria-label="Choisir le type de contenu">
        <option value="title">Titre et contenu</option>
        <option value="bullets">Liste √† puces</option>
        <option value="image">Titre et image</option>
      </select>
      <div class="image-upload" id="imageUpload${slideCounter}" style="display:none;">
        <label for="imageFile${slideCounter}">üìÅ Choisir une image</label>
        <input type="file" id="imageFile${slideCounter}" accept="image/*" onchange="previewImage(this, ${slideCounter})" />
        <img class="image-preview" id="imagePreview${slideCounter}" alt="Aper√ßu de l'image" />
        <span class="image-info" id="imageInfo${slideCounter}"></span>
      </div>
    `;
    container.appendChild(slideDiv);
    updateSlideCount();
  }

  function toggleImageUpload(selectElem, slideNum) {
    const uploadDiv = document.getElementById(`imageUpload${slideNum}`);
    uploadDiv.style.display = selectElem.value === 'image' ? 'flex' : 'none';
  }

  function previewImage(input, slideNum) {
    const preview = document.getElementById(`imagePreview${slideNum}`);
    const info = document.getElementById(`imageInfo${slideNum}`);
    if (input.files && input.files[0]) {
      const file = input.files[0];
      const reader = new FileReader();
      reader.onload = e => {
        preview.src = e.target.result;
        preview.style.display = 'block';
        info.textContent = `${file.name} (${(file.size/1024).toFixed(1)} KB)`;
      };
      reader.readAsDataURL(file);
    } else {
      preview.style.display = 'none';
      info.textContent = '';
    }
  }

  function removeSlide(btn) {
    btn.parentElement.remove();
    updateSlideCount();
  }

  function updateSlideCount() {
    const count = document.querySelectorAll('.slide-item').length;
    document.getElementById('slideCount').textContent = `${count} diapositive(s)`;
  }

  document.addEventListener('DOMContentLoaded', () => {
    checkLibraryLoaded();
    defaultSlides.forEach(title => addSlide(title));
  });

  function checkLibraryLoaded() {
    const maxAttempts = 50;
    let attempts = 0;
    const interval = setInterval(() => {
      attempts++;
      if (typeof PptxGenJS !== 'undefined') {
        clearInterval(interval);
        document.getElementById('presentationForm').style.opacity = '1';
      } else if (attempts >= maxAttempts) {
        clearInterval(interval);
        alert('Erreur : Impossible de charger la biblioth√®que PowerPoint. Actualisez la page.');
      }
    }, 100);
  }

  document.getElementById('presentationForm').addEventListener('submit', async e => {
    e.preventDefault();
    await generatePowerPoint();
  });

  async function generatePowerPoint() {
    const loading = document.getElementById('loading');
    const successMsg = document.getElementById('successMessage');
    loading.classList.add('active');
    successMsg.classList.remove('active');
    try {
      if (typeof PptxGenJS === 'undefined') throw new Error('Biblioth√®que non charg√©e.');

      const pptx = new PptxGenJS();
      const formData = new FormData(document.getElementById('presentationForm'));
      const title = formData.get('title');
      const author = formData.get('author');
      const themeName = formData.get('theme');
      const theme = themes[themeName];
      pptx.author = author || 'G√©n√©rateur PowerPoint';
      pptx.title = title;
      pptx.subject = 'Pr√©sentation g√©n√©r√©e automatiquement';

      const slides = document.querySelectorAll('.slide-item');
      const slidePromises = Array.from(slides).map(async (slideElem) => {
        const inputs = slideElem.querySelectorAll('input[type="text"], textarea, select');
        const slideTitle = inputs[0].value.trim();
        const slideContent = inputs[1].value.trim();
        const slideLayout = inputs[2].value;
        const slide = pptx.addSlide();
        slide.background = { color: theme.background };
        slide.addText(slideTitle, {
          x: 0.5, y: 0.5, w: 9, h: 1,
          fontSize: 28, color: theme.primary, bold: true
        });

        if (slideLayout === 'bullets') {
          const bullets = slideContent.split('\n').filter(line => line.trim()).map(line => line.replace(/^[-‚Ä¢]\s*/, ''));
          slide.addText(bullets, {
            x: 0.5, y: 1.8, w: 9, h: 5,
            fontSize: 18, color: '333333', bullet: true
          });
        } else if (slideLayout === 'image') {
          slide.addText(slideContent, {
            x: 0.5, y: 1.8, w: 4.5, h: 3,
            fontSize: 16, color: '333333', valign: 'top'
          });
          const fileInput = slideElem.querySelector('input[type="file"]');
          if (fileInput && fileInput.files && fileInput.files[0]) {
            const file = fileInput.files[0];
            return new Promise(resolve => {
              const reader = new FileReader();
              reader.onload = e => {
                slide.addImage({
                  data: e.target.result,
                  x: 5.5, y: 2, w: 4, h: 3,
                  sizing: { type: "contain" }
                });
                resolve();
              };
              reader.readAsDataURL(file);
            });
          } else {
            slide.addText('üì∑\n[Aucune image s√©lectionn√©e]', {
              x: 5.5, y: 2, w: 4, h: 3,
              fontSize: 14, color: '#999999',
              align: 'center', valign: 'middle',
              fill: { color: 'F5F5F5' },
              line: { color: 'CCCCCC', width: 1 }
            });
          }
        } else {
          slide.addText(slideContent, {
            x: 0.5, y: 1.8, w: 9, h: 5,
            fontSize: 18, color: '333333', valign: 'top'
          });
        }
      });

      endSlides.forEach(title => {
        const slide = pptx.addSlide();
        slide.background = { color: theme.background };
        slide.addText(title, {
          x: 0.5, y: 0.5, w: 9, h: 1,
          fontSize: 28, color: theme.primary, bold: true
        });
      });

      await Promise.all(slidePromises);

      const fileName = title ? `${title.replace(/[^\w\s]/gi, '')}.pptx` : 'presentation.pptx';
      await pptx.writeFile({ fileName });
      loading.classList.remove('active');
      successMsg.classList.add('active');
      setTimeout(() => successMsg.classList.remove('active'), 5000);
    } catch (err) {
      loading.classList.remove('active');
      alert('Erreur lors de la g√©n√©ration : ' + err.message);
      console.error(err);
    }
  }
</script>
</body>
</html>
